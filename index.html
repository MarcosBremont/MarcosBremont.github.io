<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>El Gran Planificador</title>
  <meta name="description"
    content="Sistema de Planificación Educativa por Resultados de Aprendizaje para docentes de educación técnico profesional de la República Dominicana." />
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap"
    rel="stylesheet" />
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <!-- Estilos propios -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- ===== BANNER DE BORRADOR ===== -->
  <div id="banner-borrador" class="banner-borrador hidden">
    <span class="material-icons">restore</span>
    <span>Se encontró un borrador guardado. ¿Deseas restaurarlo?</span>
    <div class="banner-actions">
      <button id="btn-restaurar" class="btn-banner btn-primary-banner">Restaurar borrador</button>
      <button id="btn-descartar-borrador" class="btn-banner btn-secondary-banner">Descartar</button>
    </div>
  </div>

  <!-- ===== HEADER ===== -->
  <header class="app-header">
    <div class="header-inner">
      <div class="header-brand">
        <button class="logo-btn" onclick="irAlHome()" title="Inicio – El Gran Planificador">
          <img src="Metabotlogo.svg" alt="El Gran Planificador" class="header-logo" />
        </button>
        <div>
          <h1 class="header-title">Planificador Educativo por RA</h1>
          <p class="header-subtitle">Sistema de Educación Técnico Profesional · República Dominicana</p>
        </div>
      </div>
      <button id="btn-notificaciones" class="btn-config-ia" onclick="abrirNotificaciones()"
        title="Notificaciones y recordatorios"
        style="position:relative;background:rgba(245,124,0,0.1);border-color:rgba(245,124,0,0.3);color:#E65100;">
        <span class="material-icons">notifications</span>
        <span class="btn-nueva-label">Avisos</span>
        <span id="notif-badge" style="display:none;position:absolute;top:4px;right:4px;background:#E53935;color:#fff;
          border-radius:50%;width:16px;height:16px;font-size:0.6rem;font-weight:800;
          display:flex;align-items:center;justify-content:center;"></span>
      </button>
      <button id="btn-buscar-est" class="btn-config-ia" onclick="abrirBuscadorEstudiante()" title="Buscar estudiante"
        style="background:rgba(0,105,92,0.1);border-color:rgba(0,150,136,0.3);color:#00695C;">
        <span class="material-icons">search</span>
        <span class="btn-nueva-label">Buscar</span>
      </button>
      <button id="btn-config-ia" class="btn-config-ia" onclick="abrirConfigIA()" title="Configurar clave de IA (Groq)">
        <span class="material-icons">settings</span>
        <span class="btn-nueva-label">Config. IA</span>
      </button>
      <button id="btn-backup" class="btn-config-ia" onclick="abrirBackup()" title="Exportar / Importar todos los datos"
        style="background:rgba(230,81,0,0.1);border-color:rgba(230,81,0,0.3);color:#E65100;">
        <span class="material-icons">backup</span>
        <span class="btn-nueva-label">Mis datos</span>
      </button>
      <button id="btn-configuracion" class="btn-config-ia" onclick="abrirConfiguracion()"
        title="Configuración de la app"
        style="background:rgba(69,39,160,0.1);border-color:rgba(149,117,205,0.3);color:#4527A0;">
        <span class="material-icons">tune</span>
        <span class="btn-nueva-label">Config.</span>
      </button>
      <button id="btn-acercade" class="btn-config-ia" onclick="abrirAcercaDe()" title="Acerca de El Gran Planificador"
        style="background:rgba(0,105,92,0.1);border-color:rgba(0,150,136,0.3);color:#00695C;">
        <span class="material-icons">info_outline</span>
        <span class="btn-nueva-label">Info</span>
      </button>
      <button id="btn-nueva-planificacion" class="btn-nueva" title="Nueva Planificación">
        <span class="material-icons">add_circle_outline</span>
        <span class="btn-nueva-label">Nueva Planificación</span>
      </button>
    </div>
  </header>

  <!-- ===== DASHBOARD ===== -->
  <div id="panel-dashboard" class="dashboard-panel hidden">
    <div class="dash-main">

      <!-- ── Saludo + stats ── -->
      <div class="dash-greeting" id="dash-greeting"></div>

      <!-- ── Alertas inteligentes ── -->
      <div id="dash-alertas"></div>

      <!-- ── Grid principal: Hoy | Mañana | Tareas ── -->
      <div class="dash-grid-3col">
        <!-- Columna 1: clases de hoy -->
        <div>
          <div class="dash-section-label">
            <span class="material-icons">today</span>Clases de hoy
            <span id="dash-hoy-fecha" style="margin-left:auto;font-size:0.75rem;color:#78909C;font-weight:400;"></span>
          </div>
          <div id="dash-hoy"></div>
        </div>
        <!-- Columna 2: clases de mañana -->
        <div>
          <div class="dash-section-label">
            <span class="material-icons">event</span>Mañana
            <span id="dash-manana-fecha"
              style="margin-left:auto;font-size:0.75rem;color:#78909C;font-weight:400;"></span>
          </div>
          <div id="dash-manana"></div>
        </div>
        <!-- Columna 3: tareas próximas -->
        <div>
          <div class="dash-section-label">
            <span class="material-icons">assignment</span>Tareas próximas
            <button onclick="abrirTareas()"
              style="margin-left:auto;background:none;border:none;color:#1565C0;font-size:0.75rem;font-weight:700;cursor:pointer;">Ver
              todas →</button>
          </div>
          <div id="dash-tareas-proximas"></div>
        </div>
      </div>

      <!-- ── Resumen de cursos ── -->
      <div class="dash-section-label" style="margin-top:8px;">
        <span class="material-icons">school</span>Estado de cursos
        <button onclick="abrirCalificaciones()"
          style="margin-left:auto;background:none;border:none;color:#1565C0;font-size:0.75rem;font-weight:700;cursor:pointer;">Ir
          al libro →</button>
      </div>
      <div id="dash-cursos"></div>

      <!-- ── Accesos rápidos ── -->
      <div class="dash-section-label" style="margin-top:8px;">
        <span class="material-icons">apps</span>Accesos rápidos
      </div>
      <div class="dash-nav-grid">
        <button class="dash-nav-btn" onclick="irAlHomeBase()" style="--accent:#1565C0;">
          <span class="material-icons">add_circle_outline</span>
          <span>Nueva Planificación</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirPlanificaciones()" style="--accent:#4527A0;">
          <span class="material-icons">folder_special</span>
          <span>Mis Planificaciones</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirDiarias()" style="--accent:#00695C;">
          <span class="material-icons">today</span>
          <span>Planificaciones Diarias</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirCalificaciones()" style="--accent:#E65100;">
          <span class="material-icons">grade</span>
          <span>Libro de Calificaciones</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirHorario()" style="--accent:#0277BD;">
          <span class="material-icons">calendar_view_week</span>
          <span>Mi Horario</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirTareas()" style="--accent:#E65100;">
          <span class="material-icons">assignment</span>
          <span>Tareas</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirNotas()" style="--accent:#5D4037;">
          <span class="material-icons">sticky_note_2</span>
          <span>Mis Notas</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirConfigIA()" style="--accent:#AD1457;">
          <span class="material-icons">auto_awesome</span>
          <span>Configurar IA</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirImportarPlanificacion()" style="--accent:#1B5E20;">
          <span class="material-icons">upload_file</span>
          <span>Importar Planificación</span>
        </button>
        <button class="dash-nav-btn" onclick="abrirBackup()" style="--accent:#BF360C;">
          <span class="material-icons">backup</span>
          <span>Mis Datos</span>
        </button>
      </div>

    </div>
  </div>

  <!-- ===== STEPPER ===== -->
  <div class="stepper-container">
    <div class="stepper" id="stepper">
      <div class="step active" data-step="1">
        <div class="step-circle">
          <span class="step-number">1</span>
          <span class="material-icons step-check hidden">check</span>
        </div>
        <span class="step-label">Datos Generales</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="2">
        <div class="step-circle">
          <span class="step-number">2</span>
          <span class="material-icons step-check hidden">check</span>
        </div>
        <span class="step-label">Resultado de Aprendizaje</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="3">
        <div class="step-circle">
          <span class="step-number">3</span>
          <span class="material-icons step-check hidden">check</span>
        </div>
        <span class="step-label">Elementos de Capacidad</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="4">
        <div class="step-circle">
          <span class="step-number">4</span>
          <span class="material-icons step-check hidden">check</span>
        </div>
        <span class="step-label">Actividades</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="5">
        <div class="step-circle">
          <span class="step-number">5</span>
          <span class="material-icons step-check hidden">check</span>
        </div>
        <span class="step-label">Vista Previa</span>
      </div>
    </div>
  </div>

  <!-- ===== CONTENIDO PRINCIPAL ===== -->
  <main class="main-content">

    <!-- =========================================
         PASO 1: DATOS GENERALES
         ========================================= -->
    <section class="step-section active" id="section-1">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon">assignment</span>
          <h2>Datos Generales del Módulo</h2>
        </div>

        <div class="form-grid">
          <!-- Familia Profesional -->
          <div class="form-group">
            <label for="familia-profesional">Familia Profesional *</label>
            <input type="text" id="familia-profesional" placeholder="Ej: Informática y Comunicaciones" required />
          </div>

          <!-- Código FP -->
          <div class="form-group">
            <label for="codigo-fp">Código FP *</label>
            <input type="text" id="codigo-fp" placeholder="Ej: IFC-001" required />
          </div>

          <!-- Nombre del Bachillerato Técnico -->
          <div class="form-group form-group--full">
            <label for="nombre-bachillerato">Nombre del Bachillerato Técnico *</label>
            <input type="text" id="nombre-bachillerato" placeholder="Ej: Bachillerato Técnico en Desarrollo de Software"
              required />
          </div>

          <!-- Código del Título -->
          <div class="form-group">
            <label for="codigo-titulo">Código del Título *</label>
            <input type="text" id="codigo-titulo" placeholder="Ej: BT-DS-2024" required />
          </div>

          <!-- Módulo Formativo -->
          <div class="form-group">
            <label for="modulo-formativo">Módulo Formativo *</label>
            <input type="text" id="modulo-formativo" placeholder="Ej: Programación Web Avanzada" required />
          </div>

          <!-- Código del Módulo -->
          <div class="form-group">
            <label for="codigo-modulo">Código del Módulo *</label>
            <input type="text" id="codigo-modulo" placeholder="Ej: MF-PWA-301" required />
          </div>

          <!-- Nombre del Docente -->
          <div class="form-group">
            <label for="nombre-docente">Nombre del Docente *</label>
            <input type="text" id="nombre-docente" placeholder="Ej: Prof. Ana García Pérez" required />
          </div>

          <!-- Cantidad de RA del Módulo -->
          <div class="form-group">
            <label for="cantidad-ra">Cantidad de RA del Módulo *</label>
            <input type="number" id="cantidad-ra" min="1" max="20" placeholder="Ej: 5" required />
          </div>

          <!-- Valor del RA (puntos) -->
          <div class="form-group">
            <label for="valor-ra">Valor del RA (puntos) *</label>
            <input type="number" id="valor-ra" min="1" max="100" placeholder="Ej: 20" required />
          </div>

          <!-- Horas por semana -->
          <div class="form-group">
            <label for="horas-semana">Horas por Semana *</label>
            <input type="number" id="horas-semana" min="1" max="40" placeholder="Ej: 6" required />
          </div>

          <!-- Fecha de Inicio -->
          <div class="form-group">
            <label for="fecha-inicio">Fecha de Inicio *</label>
            <input type="date" id="fecha-inicio" required />
          </div>

          <!-- Fecha de Término -->
          <div class="form-group">
            <label for="fecha-termino">Fecha de Término *</label>
            <input type="date" id="fecha-termino" required />
          </div>
        </div>

        <!-- Días de clase + horas por día -->
        <div class="dias-clase-section">
          <h3 class="subsection-title">
            <span class="material-icons">calendar_today</span>
            Días de Clase por Semana
          </h3>
          <p class="subsection-hint">Selecciona los días y especifica las horas de clase cada día.</p>
          <div class="dias-grid">
            <!-- Lunes -->
            <div class="dia-card" id="dia-card-lunes">
              <label class="dia-checkbox-label">
                <input type="checkbox" id="dia-lunes" class="dia-checkbox" value="lunes" />
                <span class="dia-nombre">Lunes</span>
              </label>
              <div class="dia-horas hidden" id="horas-lunes-wrap">
                <input type="number" id="horas-lunes" min="1" max="8" value="2" class="input-horas" />
                <span class="horas-label">hrs</span>
              </div>
            </div>
            <!-- Martes -->
            <div class="dia-card" id="dia-card-martes">
              <label class="dia-checkbox-label">
                <input type="checkbox" id="dia-martes" class="dia-checkbox" value="martes" />
                <span class="dia-nombre">Martes</span>
              </label>
              <div class="dia-horas hidden" id="horas-martes-wrap">
                <input type="number" id="horas-martes" min="1" max="8" value="2" class="input-horas" />
                <span class="horas-label">hrs</span>
              </div>
            </div>
            <!-- Miércoles -->
            <div class="dia-card" id="dia-card-miercoles">
              <label class="dia-checkbox-label">
                <input type="checkbox" id="dia-miercoles" class="dia-checkbox" value="miercoles" />
                <span class="dia-nombre">Miércoles</span>
              </label>
              <div class="dia-horas hidden" id="horas-miercoles-wrap">
                <input type="number" id="horas-miercoles" min="1" max="8" value="2" class="input-horas" />
                <span class="horas-label">hrs</span>
              </div>
            </div>
            <!-- Jueves -->
            <div class="dia-card" id="dia-card-jueves">
              <label class="dia-checkbox-label">
                <input type="checkbox" id="dia-jueves" class="dia-checkbox" value="jueves" />
                <span class="dia-nombre">Jueves</span>
              </label>
              <div class="dia-horas hidden" id="horas-jueves-wrap">
                <input type="number" id="horas-jueves" min="1" max="8" value="2" class="input-horas" />
                <span class="horas-label">hrs</span>
              </div>
            </div>
            <!-- Viernes -->
            <div class="dia-card" id="dia-card-viernes">
              <label class="dia-checkbox-label">
                <input type="checkbox" id="dia-viernes" class="dia-checkbox" value="viernes" />
                <span class="dia-nombre">Viernes</span>
              </label>
              <div class="dia-horas hidden" id="horas-viernes-wrap">
                <input type="number" id="horas-viernes" min="1" max="8" value="2" class="input-horas" />
                <span class="horas-label">hrs</span>
              </div>
            </div>
          </div>
          <!-- Resumen de horas calculadas -->
          <div id="resumen-horas" class="resumen-horas hidden">
            <span class="material-icons">schedule</span>
            <span id="resumen-horas-texto"></span>
          </div>
        </div>

      </div>

      <!-- Navegación -->
      <div class="nav-buttons">
        <div></div>
        <button class="btn-siguiente" onclick="irAlPaso(2)">
          Siguiente
          <span class="material-icons">arrow_forward</span>
        </button>
      </div>
    </section>


    <!-- =========================================
         PASO 2: RESULTADO DE APRENDIZAJE
         ========================================= -->
    <section class="step-section" id="section-2">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon">psychology</span>
          <h2>Resultado de Aprendizaje y Criterios</h2>
        </div>

        <div class="form-grid">
          <!-- Descripción del RA -->
          <div class="form-group form-group--full">
            <label for="descripcion-ra">Descripción del Resultado de Aprendizaje (RA) *</label>
            <textarea id="descripcion-ra" rows="5"
              placeholder="Escribe aquí la descripción completa del RA. Ej: El/la estudiante será capaz de desarrollar aplicaciones web usando JavaScript moderno, aplicando principios de diseño responsivo y buenas prácticas de programación, demostrando compromiso con la calidad del código..."
              required></textarea>
            <div id="nivel-bloom-detectado" class="bloom-badge hidden"></div>
          </div>

          <!-- Criterios de Evaluación de Referencia -->
          <div class="form-group form-group--full">
            <label for="criterios-referencia">
              Criterios de Evaluación de Referencia del Currículo
              <span class="label-optional">(opcional, uno por línea)</span>
            </label>
            <textarea id="criterios-referencia" rows="5"
              placeholder="Ingresa los criterios del currículo, uno por línea. Ej:&#10;Identifica los fundamentos de la programación orientada a objetos&#10;Desarrolla interfaces de usuario responsivas&#10;Aplica buenas prácticas de codificación"></textarea>
          </div>

          <!-- Recursos didácticos -->
          <div class="form-group form-group--full">
            <label for="recursos-didacticos">Recursos Didácticos Disponibles</label>
            <textarea id="recursos-didacticos" rows="3"
              placeholder="Ej: Computadoras con acceso a internet, proyector, pizarrón digital, plataforma Moodle, herramientas de desarrollo VS Code..."></textarea>
          </div>
        </div>

        <!-- Info tip -->
        <div class="info-tip">
          <span class="material-icons">lightbulb</span>
          <p>El sistema analizará el texto del RA para detectar su nivel de dominio según la <strong>Taxonomía de
              Bloom</strong> y generará automáticamente los Elementos de Capacidad (EC) adecuados.</p>
        </div>

      </div>

      <!-- Botón Generar -->
      <div class="generar-section">
        <button id="btn-generar" class="btn-generar" onclick="generarPlanificacion()">
          <span class="material-icons btn-generar-icon">auto_awesome</span>
          <span id="btn-generar-texto">Generar Planificación</span>
        </button>
      </div>

      <!-- Navegación -->
      <div class="nav-buttons">
        <button class="btn-anterior" onclick="irAlPaso(1)">
          <span class="material-icons">arrow_back</span>
          Anterior
        </button>
        <button class="btn-siguiente" onclick="irAlPaso(3)" id="btn-paso2-siguiente" disabled>
          Siguiente
          <span class="material-icons">arrow_forward</span>
        </button>
      </div>
    </section>


    <!-- =========================================
         PASO 3: ELEMENTOS DE CAPACIDAD
         ========================================= -->
    <section class="step-section" id="section-3">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon">layers</span>
          <h2>Elementos de Capacidad (EC)</h2>
        </div>

        <div class="info-tip">
          <span class="material-icons">edit_note</span>
          <p>Los EC han sido generados automáticamente. Puedes <strong>editarlos</strong> haciendo clic en el texto. Los
            cambios se guardan automáticamente.</p>
        </div>

        <!-- Resumen de horas distribuidas -->
        <div id="resumen-distribucion" class="resumen-distribucion hidden">
          <div class="resumen-item">
            <span class="material-icons">schedule</span>
            <div>
              <strong id="total-horas-display">--</strong>
              <small>Horas totales</small>
            </div>
          </div>
          <div class="resumen-item">
            <span class="material-icons">calendar_month</span>
            <div>
              <strong id="total-semanas-display">--</strong>
              <small>Semanas</small>
            </div>
          </div>
          <div class="resumen-item">
            <span class="material-icons">bar_chart</span>
            <div>
              <strong id="horas-por-ec-display">--</strong>
              <small>Horas por EC</small>
            </div>
          </div>
        </div>

        <!-- Tarjetas de EC -->
        <div id="ec-container" class="ec-container">
          <!-- Se genera dinámicamente por JS -->
        </div>

        <!-- Botón agregar EC -->
        <div style="display:flex;justify-content:center;margin-top:16px;">
          <button onclick="_agregarNuevoEC()"
            style="display:flex;align-items:center;gap:7px;background:#E3F2FD;border:1.5px solid #90CAF9;color:#1565C0;border-radius:20px;padding:9px 22px;font-size:0.85rem;font-weight:700;cursor:pointer;transition:all 0.15s;">
            <span class="material-icons">add_circle</span> Agregar Elemento de Capacidad
          </button>
        </div>

      </div>

      <!-- Navegación -->
      <div class="nav-buttons">
        <button class="btn-anterior" onclick="irAlPaso(2)">
          <span class="material-icons">arrow_back</span>
          Anterior
        </button>
        <button class="btn-siguiente" onclick="irAlPaso(4)">
          Siguiente
          <span class="material-icons">arrow_forward</span>
        </button>
      </div>
    </section>


    <!-- =========================================
         PASO 4: ACTIVIDADES E INSTRUMENTOS
         ========================================= -->
    <section class="step-section" id="section-4">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon">event_note</span>
          <h2>Actividades e Instrumentos de Evaluación</h2>
        </div>

        <div class="info-tip">
          <span class="material-icons">info</span>
          <p>Las actividades tienen fechas reales calculadas según los días de clase ingresados. Haz clic en
            <strong>"Ver instrumento"</strong> para visualizar la lista de cotejo o rúbrica correspondiente.
          </p>
        </div>

        <!-- Alerta ECs sin actividades -->
        <div id="alerta-ec-sin-act" style="display:none;align-items:center;gap:8px;
          background:#FFF3E0;border:1.5px solid #FFCC80;border-radius:9px;
          padding:10px 14px;font-size:0.82rem;color:#E65100;margin-bottom:12px;">
        </div>

        <!-- Tabla de actividades -->
        <div class="tabla-responsiva">
          <table id="tabla-actividades" class="tabla-actividades">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>EC</th>
                <th>Actividad</th>
                <th>Instrumento</th>
                <th style="text-align:center;">Valor (pts)</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-actividades-body">
              <!-- Se llena dinámicamente -->
            </tbody>
          </table>
        </div>

        <!-- Botón agregar nueva actividad -->
        <div style="display:flex;justify-content:center;margin-top:14px;">
          <button onclick="_agregarNuevaActividad()"
            style="display:flex;align-items:center;gap:6px;background:#E3F2FD;border:1.5px solid #90CAF9;color:#1565C0;border-radius:20px;padding:8px 20px;font-size:0.85rem;font-weight:700;cursor:pointer;transition:all 0.15s;">
            <span class="material-icons">add_circle</span> Agregar actividad
          </button>
        </div>

      </div>

      <!-- Navegación -->
      <div class="nav-buttons">
        <button class="btn-anterior" onclick="irAlPaso(3)">
          <span class="material-icons">arrow_back</span>
          Anterior
        </button>
        <button class="btn-siguiente" onclick="irAlPaso(5)">
          Ver Vista Previa
          <span class="material-icons">preview</span>
        </button>
      </div>
    </section>


    <!-- =========================================
         PASO 5: VISTA PREVIA Y EXPORTACIÓN
         ========================================= -->
    <section class="step-section" id="section-5">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon">picture_as_pdf</span>
          <h2>Vista Previa y Exportación</h2>
        </div>

        <!-- Botones de exportación -->
        <div class="export-buttons">
          <button class="btn-export btn-print" onclick="imprimirPDF()">
            <span class="material-icons">print</span>
            Imprimir / PDF
          </button>
          <button class="btn-export btn-word" onclick="exportarWord()">
            <span class="material-icons">description</span>
            Exportar a Word
          </button>
          <button class="btn-export btn-copy" onclick="copiarPortapapeles()">
            <span class="material-icons">content_copy</span>
            Copiar al portapapeles
          </button>
        </div>

        <!-- Vista previa imprimible -->
        <div id="vista-previa" class="vista-previa">
          <!-- Se genera dinámicamente -->
        </div>

      </div>

      <!-- Navegación -->
      <div class="nav-buttons">
        <button class="btn-anterior" onclick="irAlPaso(4)">
          <span class="material-icons">arrow_back</span>
          Anterior
        </button>
        <div></div>
      </div>
    </section>


    <!-- ===== PANEL CALIFICACIONES (outside stepper) ===== -->
    <div id="panel-calificaciones" class="cal-panel hidden">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon" style="background:#E8F5E9;color:#2E7D32;">grade</span>
          <h2>Libro de Calificaciones</h2>
          <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
            <button class="btn-export btn-sm" id="btn-toggle-asistencia" onclick="toggleVistaAsistencia()"
              style="background:#E3F2FD;border:1.5px solid #90CAF9;color:#1565C0;">
              <span class="material-icons">how_to_reg</span> Asistencia
            </button>
            <button class="btn-export btn-word btn-sm" onclick="exportarCalificacionesWord()">
              <span class="material-icons">description</span> Exportar Word
            </button>
            <button class="btn-export btn-print btn-sm" onclick="imprimirCalificaciones()">
              <span class="material-icons">print</span> Imprimir
            </button>
          </div>
        </div>

        <!-- Selector / creador de cursos -->
        <div class="cal-cursos-bar">
          <div class="cal-cursos-label">
            <span class="material-icons">class</span> Curso:
          </div>
          <div id="cal-tabs" class="cal-tabs"></div>
          <button class="btn-cal-add-curso" id="btn-add-curso" onclick="abrirModalNuevoCurso()">
            <span class="material-icons">add</span> Nuevo curso
          </button>
        </div>

        <!-- Añadir estudiantes -->
        <div class="cal-add-estudiantes" id="cal-add-estudiantes-area">
          <div class="cal-field-group">
            <span class="material-icons" style="color:#1565C0;">person_add</span>
            <textarea id="input-estudiantes" rows="3"
              placeholder="Escribe los nombres de los estudiantes, uno por línea. Ej:&#10;María García&#10;Juan Pérez&#10;Ana López"></textarea>
            <button class="btn-siguiente" style="align-self:flex-end;white-space:nowrap;"
              onclick="agregarEstudiantes()">
              <span class="material-icons">group_add</span> Agregar
            </button>
          </div>
          <p class="subsection-hint" style="margin-top:4px;">
            También puedes hacer clic en <strong>Editar nombre</strong> en la tabla para corregir un nombre, o en
            <strong style="color:#C62828;">✕</strong> para eliminar un estudiante.
          </p>
        </div>

        <!-- Planificaciones del curso activo -->
        <div id="cal-planes-bar" style="margin-bottom:12px;"></div>

        <!-- Panel de asistencia (toggle) -->
        <div id="cal-asist-panel" class="hidden">
          <div class="asist-panel-wrap" id="cal-asist-wrap"></div>
          <div style="margin-top:8px;border-top:1px solid #E0E0E0;padding-top:12px;"></div>
        </div>

        <!-- Info si no hay actividades cargadas -->
        <div id="cal-sin-actividades" class="info-tip hidden" style="margin-bottom:16px;">
          <span class="material-icons">info</span>
          <p>Asigna una planificación a este curso para comenzar a registrar calificaciones.</p>
        </div>

        <!-- Tabla de calificaciones -->
        <div class="tabla-responsiva" id="cal-tabla-wrap">
          <table id="tabla-calificaciones" class="tabla-cal">
            <thead id="cal-thead"></thead>
            <tbody id="cal-tbody"></tbody>
            <tfoot id="cal-tfoot"></tfoot>
          </table>
        </div>

        <!-- Leyenda -->
        <div class="cal-leyenda">
          <span class="cal-badge cal-aprobado">≥ 70 Aprobado</span>
          <span class="cal-badge cal-regular">60–69 Regular</span>
          <span class="cal-badge cal-reprobado">
            < 60 Reprobado</span>
              <span style="margin-left:auto;font-size:0.78rem;color:#757575;">Las notas se guardan automáticamente en el
                navegador.</span>
        </div>
      </div>

      <!-- Botón para volver a la planificación -->
      <div class="nav-buttons">
        <button class="btn-anterior" onclick="cerrarCalificaciones()">
          <span class="material-icons">arrow_back</span> Volver a la planificación
        </button>
      </div>
    </div>


    <!-- ===== PANEL PLANIFICACIONES (Biblioteca) ===== -->
    <div id="panel-planificaciones" class="pln-panel hidden">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon" style="background:#EDE7F6;color:#4527A0;">folder_special</span>
          <h2>Mis Planificaciones Guardadas</h2>
          <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn-nueva"
              style="background:rgba(21,101,192,0.12);border-color:rgba(144,202,249,0.6);color:#1565C0;"
              onclick="abrirImportarPlanificacion()">
              <span class="material-icons">upload_file</span>
              <span class="btn-nueva-label">Importar planificación</span>
            </button>
            <button class="btn-nueva" style="background:rgba(69,39,160,0.18);border-color:rgba(179,157,219,0.6);"
              onclick="nuevaPlanificacion()">
              <span class="material-icons">add_circle_outline</span>
              <span class="btn-nueva-label">Nueva planificación</span>
            </button>
          </div>
        </div>

        <div class="info-tip" style="border-color:#7E57C2;background:#EDE7F6;">
          <span class="material-icons" style="color:#4527A0;">save</span>
          <p>Guarda la planificación actual con el botón <strong>"Guardar planificación"</strong> en cualquier paso.
            Aquí aparecerán todas las que hayas guardado para retomarlas cuando quieras.</p>
        </div>

        <!-- Buscador -->
        <div class="pln-search-bar">
          <span class="material-icons" style="color:#9E9E9E;">search</span>
          <input type="text" id="pln-buscador" placeholder="Buscar por módulo, docente o bachillerato..."
            oninput="filtrarPlanificaciones()" />
        </div>

        <!-- Grid de tarjetas -->
        <div id="pln-grid" class="pln-grid">
          <!-- Se llena dinámicamente -->
        </div>

        <!-- Estado vacío -->
        <div id="pln-vacio" class="pln-vacio hidden">
          <span class="material-icons">folder_open</span>
          <p>No hay planificaciones guardadas todavía.</p>
          <p>Completa una planificación y haz clic en <strong>"Guardar planificación"</strong>.</p>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn-anterior" onclick="cerrarPlanificaciones()">
          <span class="material-icons">arrow_back</span> Volver
        </button>
      </div>
    </div>


    <!-- ===== PANEL PLANIFICACIONES DIARIAS ===== -->
    <div id="panel-diarias" class="pd-panel hidden">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon" style="background:#E3F2FD;color:#0D47A1;">today</span>
          <h2>Planificaciones Diarias</h2>
          <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn-export btn-word btn-sm" onclick="exportarDiariasWord()">
              <span class="material-icons">description</span> Exportar Word
            </button>
            <button class="btn-export btn-print btn-sm" onclick="imprimirDiarias()">
              <span class="material-icons">print</span> Imprimir
            </button>
          </div>
        </div>

        <div class="info-tip" style="border-color:#1565C0;background:#E3F2FD;">
          <span class="material-icons" style="color:#0D47A1;">lightbulb</span>
          <p>Cada <strong>actividad</strong> de tu planificación general se convierte en una sesión diaria con sus
            tres momentos pedagógicos. Haz clic en <strong>"Generar"</strong> para auto-generar el contenido, o
            escribe directamente en los campos.</p>
        </div>

        <!-- Sin actividades -->
        <div id="pd-sin-actividades" class="pln-vacio hidden">
          <span class="material-icons">event_busy</span>
          <p>No hay actividades generadas.</p>
          <p>Completa los primeros 4 pasos de la planificación y vuelve aquí.</p>
        </div>

        <!-- Selector de EC -->
        <div id="pd-filtro-bar" class="pd-filtro-bar hidden">
          <span style="font-weight:600;color:#0D47A1;font-size:0.9rem;">Filtrar por EC:</span>
          <div id="pd-filtro-chips" class="pd-filtro-chips">
            <button class="pd-chip-flt activo" data-ec="todos" onclick="filtrarSesionesEC(this,'todos')">Todas</button>
          </div>
        </div>

        <!-- Lista de sesiones -->
        <div id="pd-sesiones-lista" class="pd-sesiones-lista"></div>
      </div>

      <div class="nav-buttons">
        <button class="btn-anterior" onclick="cerrarDiarias()">
          <span class="material-icons">arrow_back</span> Volver
        </button>
        <button class="btn-guardar-plan" onclick="guardarTodasDiarias()">
          <span class="material-icons">save</span> Guardar cambios
        </button>
      </div>
    </div>

    <!-- ===== PANEL NOTAS DEL DOCENTE ===== -->
    <div id="panel-notas" class="cal-panel hidden">
      <div class="section-card">
        <div class="section-header">
          <span class="material-icons section-icon" style="background:#EFEBE9;color:#5D4037;">sticky_note_2</span>
          <h2>Mis Notas</h2>
          <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
            <span id="notas-guardado-ind" style="display:none;font-size:0.78rem;color:#2E7D32;font-weight:600;">✓
              Guardado</span>
          </div>
        </div>
        <p style="font-size:0.85rem;color:#757575;margin-bottom:12px;">Espacio libre para anotar recordatorios, ideas,
          pendientes o cualquier cosa importante. Se guarda automáticamente.</p>
        <textarea id="notas-docente-textarea"
          placeholder="Escribe aquí tus notas...&#10;&#10;Ejemplo:&#10;• Recordar revisar exámenes del 2do B&#10;• Pedir materiales para el laboratorio&#10;• Reunión con padres el viernes"
          style="width:100%;min-height:400px;border:1.5px solid #BCAAA4;border-radius:10px;padding:16px;font-family:'Roboto',sans-serif;font-size:0.95rem;line-height:1.7;resize:vertical;background:#FAFAFA;color:#333;transition:border-color 0.2s;"
          oninput="guardarNotasDocente()" onfocus="this.style.borderColor='#5D4037'"
          onblur="this.style.borderColor='#BCAAA4'"></textarea>
        <div style="display:flex;gap:12px;margin-top:12px;align-items:center;flex-wrap:wrap;">
          <span style="font-size:0.78rem;color:#9E9E9E;"><span class="material-icons"
              style="font-size:14px;vertical-align:middle;">info</span> Las notas se guardan automáticamente mientras
            escribes</span>
          <button class="btn-anterior" style="margin-left:auto;" onclick="limpiarNotasDocente()">
            <span class="material-icons">delete_outline</span> Borrar todo
          </button>
        </div>
      </div>
      <div class="nav-buttons">
        <button class="btn-anterior" onclick="cerrarNotas()">
          <span class="material-icons">arrow_back</span> Volver
        </button>
      </div>
    </div>

  </main>


  <!-- ===== PANEL HORARIO ===== -->
  <div id="panel-horario" class="cal-panel hidden">
    <div class="section-card">
      <div class="section-header">
        <span class="material-icons section-icon" style="background:#E3F2FD;color:#0D47A1;">calendar_view_week</span>
        <h2>Mi Horario de Clases</h2>
        <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn-export btn-print btn-sm" onclick="window.print()">
            <span class="material-icons">print</span> Imprimir
          </button>
        </div>
      </div>
      <p style="font-size:0.82rem;color:#78909C;margin:0 0 12px;">
        <span class="material-icons" style="font-size:14px;vertical-align:middle;">info</span>
        Haz clic en cualquier celda para agregar o editar una clase.
      </p>
      <div id="horario-leyenda" style="margin-bottom:14px;"></div>
      <div class="tabla-responsiva" id="horario-tabla"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn-anterior" onclick="cerrarHorario()">
        <span class="material-icons">arrow_back</span> Volver
      </button>
    </div>
  </div>

  <!-- ===== PANEL TAREAS ===== -->
  <div id="panel-tareas" class="cal-panel hidden">
    <div class="section-card">
      <div class="section-header">
        <span class="material-icons section-icon" style="background:#FFF3E0;color:#E65100;">assignment</span>
        <h2>Tareas</h2>
        <div style="margin-left:auto;">
          <button class="btn-siguiente" onclick="abrirNuevaTarea()" style="font-size:0.82rem;padding:8px 16px;">
            <span class="material-icons">add</span> Nueva tarea
          </button>
        </div>
      </div>

      <!-- Filtros -->
      <div class="tareas-filtros-bar">
        <button class="tarea-filtro-btn activo" data-filtro="todas" onclick="filtrarTareas('todas')">
          Todas <span class="tarea-count">0</span>
        </button>
        <button class="tarea-filtro-btn" data-filtro="pendiente" onclick="filtrarTareas('pendiente')">
          <span
            style="display:inline-block;width:8px;height:8px;border-radius:50%;background:#F57F17;margin-right:4px;"></span>
          Pendientes <span class="tarea-count">0</span>
        </button>
        <button class="tarea-filtro-btn" data-filtro="entregada" onclick="filtrarTareas('entregada')">
          <span
            style="display:inline-block;width:8px;height:8px;border-radius:50%;background:#2E7D32;margin-right:4px;"></span>
          Entregadas <span class="tarea-count">0</span>
        </button>
        <button class="tarea-filtro-btn" data-filtro="vencida" onclick="filtrarTareas('vencida')">
          <span
            style="display:inline-block;width:8px;height:8px;border-radius:50%;background:#C62828;margin-right:4px;"></span>
          Vencidas <span class="tarea-count">0</span>
        </button>
        <select id="tarea-filtro-seccion" onchange="renderizarTareas()"
          style="margin-left:auto;padding:6px 10px;border:1.5px solid #E0E0E0;border-radius:20px;font-size:0.8rem;background:#fff;color:#424242;cursor:pointer;">
          <option value="">Todas las secciones</option>
        </select>
      </div>

      <!-- Lista de tareas -->
      <div id="tareas-container"></div>
    </div>
    <div class="nav-buttons">
      <button class="btn-anterior" onclick="cerrarTareas()">
        <span class="material-icons">arrow_back</span> Volver
      </button>
    </div>
  </div>

  <!-- ===== MODAL CONFIGURACIÓN ===== -->
  <div id="config-overlay" class="modal-overlay hidden" onclick="this.id==='config-overlay'&&cerrarConfiguracion()">
    <div class="modal-box" style="max-width:500px;" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3><span class="material-icons"
            style="vertical-align:middle;margin-right:6px;font-size:20px;">tune</span>Configuración</h3>
        <button class="modal-close" onclick="cerrarConfiguracion()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body" style="padding:20px 24px;">

        <!-- Apariencia -->
        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">palette</span>Apariencia</div>
          <div class="toggle-row">
            <div class="toggle-label">
              Modo oscuro
              <small>Cambia el tema de la aplicación</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="cfg-dark-mode" onchange="toggleDarkMode(this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row">
            <div class="toggle-label">
              Fuente grande
              <small>Aumenta el tamaño del texto</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="cfg-fuente-grande" onchange="toggleFuenteGrande(this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Asistencia -->
        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">how_to_reg</span>Asistencia</div>
          <div class="toggle-row">
            <div class="toggle-label">
              Umbral de alerta (%)
              <small>Alerta cuando un estudiante baja de este porcentaje</small>
            </div>
            <input type="number" id="cfg-umbral-asist" min="1" max="100" value="80"
              onchange="localStorage.setItem('asist_umbral',this.value);mostrarToast('Umbral guardado','success')"
              style="width:64px;padding:6px 8px;border:1.5px solid #90CAF9;border-radius:8px;font-size:0.9rem;font-weight:700;text-align:center;">
          </div>
        </div>

        <!-- Dashboard -->
        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">dashboard</span>Dashboard</div>
          <div class="toggle-row">
            <div class="toggle-label">
              Mostrar alertas inteligentes
              <small>Avisos de tareas vencidas, cursos sin plan, etc.</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="cfg-alertas"
                onchange="localStorage.setItem('cfg_alertas',this.checked);renderizarDashboard()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row">
            <div class="toggle-label">
              Mostrar columna "Mañana"
              <small>Clases del día siguiente en el dashboard</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="cfg-manana"
                onchange="localStorage.setItem('cfg_manana',this.checked);renderizarDashboard()">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Datos -->
        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">storage</span>Datos</div>
          <button onclick="if(confirm('¿Borrar TODOS los datos? Esta acción no se puede deshacer.'))limpiarTodosDatos()"
            style="width:100%;background:#FFF5F5;border:1.5px solid #FFCDD2;color:#C62828;border-radius:8px;padding:10px;font-size:0.82rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
            <span class="material-icons" style="font-size:16px;">delete_forever</span>
            Borrar todos los datos locales
          </button>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn-siguiente" onclick="cerrarConfiguracion()">Listo</button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL ACERCA DE ===== -->
  <div id="acercade-overlay" class="modal-overlay hidden" onclick="this.id==='acercade-overlay'&&cerrarAcercaDe()">
    <div class="modal-box" style="max-width:560px;max-height:88vh;overflow-y:auto;" onclick="event.stopPropagation()">
      <div class="modal-header" style="position:sticky;top:0;z-index:1;">
        <h3><span class="material-icons"
            style="vertical-align:middle;margin-right:6px;font-size:20px;">info_outline</span>Acerca de</h3>
        <button class="modal-close" onclick="cerrarAcercaDe()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body" style="padding:20px 24px;">

        <div class="about-header">
          <img src="Metabotlogo.svg" alt="Logo" class="about-logo" onerror="this.style.display='none'">
          <div>
            <div class="about-app-nombre">El Gran Planificador Educativo</div>
            <div class="about-app-desc">Sistema de Planificación para Docentes · Educación Técnico Profesional ·
              República Dominicana</div>
            <div style="margin-top:6px;font-size:0.72rem;color:#9E9E9E;">Desarrollado por Marcos J. Simé Bremont</div>
          </div>
        </div>

        <div style="margin-bottom:12px;">
          <div
            style="font-size:0.78rem;font-weight:800;color:#1565C0;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:10px;">
            Historial de versiones
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge" style="background:#1565C0;">v7.0<span class="about-ver-fecha">Feb 2026</span>
              </div>
            </div>
            <div>
              <div class="about-ver-titulo">Edición completa de planificaciones duplicadas</div>
              <ul class="about-ver-items">
                <li>Biblioteca agrupada por curso con indicador de plan activa</li>
                <li>Permite múltiples planificaciones por módulo (distintos RA)</li>
                <li>Editar nivel Bloom del EC con dropdown directo en la card</li>
                <li>Editar código EC (E.C.1.1.1, E.C.1.1.2, etc.) desde la card</li>
                <li>Agregar nuevos EC manualmente con código, nivel, enunciado y horas</li>
                <li>Agregar nuevas actividades desde el paso 4 con selección de EC</li>
                <li>Editar enunciado, fecha, EC e instrumento de cada actividad</li>
                <li>Cambiar instrumento (cotejo/rúbrica) directamente en la tabla</li>
                <li>Editar valor en puntos de cada actividad inline en la tabla</li>
                <li>Eliminar actividades con confirmación</li>
                <li>Alerta visual de ECs sin actividades al entrar al paso 4</li>
                <li>Vista previa con colores correctos en modo oscuro</li>
                <li>Auto-regeneración de instrumentos al abrir "Ver"</li>
              </ul>
            </div>
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge">v6.0<span class="about-ver-fecha">Feb 2026</span></div>
            </div>
            <div>
              <div class="about-ver-titulo">Asistencia, Horario, Tareas y Dashboard inteligente</div>
              <ul class="about-ver-items">
                <li>Módulo completo de asistencia (P/T/A/E) con historial, reporte y umbral configurable</li>
                <li>Módulo de horario semanal editable con colores por materia</li>
                <li>Módulo de tareas agrupadas por curso con estados y alertas</li>
                <li>Dashboard rediseñado: clases de hoy y mañana, tareas próximas, resumen de cursos</li>
                <li>Modal de detalle por clase: actividad, asistencia rápida, forma de evaluación y notas</li>
                <li>Notas rápidas de clase con guardado automático</li>
                <li>Configuración general y pantalla Acerca de</li>
                <li>Modo oscuro completo</li>
              </ul>
            </div>
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge">v5.0<span class="about-ver-fecha">Ene 2026</span></div>
            </div>
            <div>
              <div class="about-ver-titulo">Libro de Calificaciones y Edición de Planificaciones</div>
              <ul class="about-ver-items">
                <li>Libro de calificaciones por Resultado de Aprendizaje (RA)</li>
                <li>Múltiples cursos y planificaciones por curso</li>
                <li>Edición completa de planificaciones cargadas desde biblioteca</li>
                <li>Edición inline de EC, secuencia didáctica y actividades</li>
                <li>Regeneración automática de instrumentos al editar</li>
              </ul>
            </div>
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge">v4.0<span class="about-ver-fecha">Dic 2025</span></div>
            </div>
            <div>
              <div class="about-ver-titulo">Biblioteca, Exportación Word y Planificaciones Diarias</div>
              <ul class="about-ver-items">
                <li>Biblioteca de planificaciones guardadas</li>
                <li>Exportación a Word con formato institucional</li>
                <li>Módulo de planificaciones diarias por sesión</li>
                <li>Wizard de importación desde documentos Word</li>
              </ul>
            </div>
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge">v3.0<span class="about-ver-fecha">Nov 2025</span></div>
            </div>
            <div>
              <div class="about-ver-titulo">Instrumentos de Evaluación con IA</div>
              <ul class="about-ver-items">
                <li>Generación automática de rúbricas y listas de cotejo con Groq IA</li>
                <li>Instrumentos personalizados por nivel de Bloom y EC</li>
                <li>Vista y exportación de instrumentos por actividad</li>
              </ul>
            </div>
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge">v2.0<span class="about-ver-fecha">Oct 2025</span></div>
            </div>
            <div>
              <div class="about-ver-titulo">Planificación por Elementos de Capacidad</div>
              <ul class="about-ver-items">
                <li>Wizard de 3 pasos: Datos Generales → EC → Actividades</li>
                <li>Secuencia didáctica (Anticipación, Construcción, Consolidación)</li>
                <li>Generación de actividades por EC con IA</li>
                <li>Stepper visual con progreso</li>
              </ul>
            </div>
          </div>

          <div class="about-version-row">
            <div>
              <div class="about-ver-badge">v1.0<span class="about-ver-fecha">Sep 2025</span></div>
            </div>
            <div>
              <div class="about-ver-titulo">Lanzamiento inicial</div>
              <ul class="about-ver-items">
                <li>Planificación educativa básica por RA</li>
                <li>Datos generales del módulo formativo</li>
                <li>Primeras funciones de guardado en navegador</li>
              </ul>
            </div>
          </div>

        </div>
      </div>
      <div class="modal-footer" style="position:sticky;bottom:0;">
        <button class="btn-siguiente" onclick="cerrarAcercaDe()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL NOTIFICACIONES ===== -->
  <div id="notif-overlay" class="modal-overlay hidden" onclick="event.target===this&&cerrarNotificaciones()">
    <div class="modal-box" style="max-width:520px;max-height:88vh;display:flex;flex-direction:column;"
      onclick="event.stopPropagation()">
      <div class="modal-header" style="flex-shrink:0;">
        <h3><span class="material-icons"
            style="vertical-align:middle;margin-right:6px;font-size:20px;">notifications</span>
          Avisos y recordatorios
          <span id="notif-count-header" style="font-size:0.75rem;font-weight:400;color:#9E9E9E;margin-left:6px;"></span>
        </h3>
        <button class="modal-close" onclick="cerrarNotificaciones()"><span class="material-icons">close</span></button>
      </div>
      <div id="notif-modal-body" style="flex:1;overflow-y:auto;padding:16px 20px;"></div>
      <div class="modal-footer" style="flex-shrink:0;">
        <button class="btn-secundario" onclick="cerrarNotificaciones()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL EXPORTAR ASISTENCIA ===== -->
  <div id="exp-asist-overlay" class="modal-overlay hidden" onclick="event.target===this&&cerrarExpAsistencia()">
    <div class="modal-box" style="max-width:500px;" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3><span class="material-icons"
            style="vertical-align:middle;margin-right:6px;font-size:20px;">table_chart</span>Exportar asistencia</h3>
        <button class="modal-close" onclick="cerrarExpAsistencia()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body" style="padding:20px 24px;">

        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">class</span>Curso</div>
          <select id="exp-asist-curso"
            style="width:100%;padding:8px 10px;border:1.5px solid #E0E0E0;border-radius:8px;font-size:0.9rem;font-family:inherit;">
          </select>
        </div>

        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">date_range</span>Período</div>
          <div style="display:flex;gap:10px;align-items:center;">
            <label style="font-size:0.82rem;color:#546E7A;flex-shrink:0;">Desde</label>
            <input type="date" id="exp-asist-desde"
              style="flex:1;padding:7px 10px;border:1.5px solid #E0E0E0;border-radius:8px;font-size:0.85rem;font-family:inherit;">
            <label style="font-size:0.82rem;color:#546E7A;flex-shrink:0;">Hasta</label>
            <input type="date" id="exp-asist-hasta"
              style="flex:1;padding:7px 10px;border:1.5px solid #E0E0E0;border-radius:8px;font-size:0.85rem;font-family:inherit;">
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
            <button onclick="setExpAsistPeriodo('mes')" class="exp-asist-periodo-btn">Este mes</button>
            <button onclick="setExpAsistPeriodo('trimestre')" class="exp-asist-periodo-btn">Últimos 3 meses</button>
            <button onclick="setExpAsistPeriodo('todo')" class="exp-asist-periodo-btn">Todo el registro</button>
          </div>
        </div>

        <div class="config-section" style="border:none;margin-bottom:0;">
          <div class="config-section-title"><span class="material-icons">download</span>Formato</div>
          <div style="display:flex;gap:10px;">
            <button onclick="generarReporteAsistenciaWord()" class="exp-asist-format-btn"
              style="flex:1;background:#E3F2FD;border-color:#90CAF9;color:#1565C0;">
              <span class="material-icons">description</span>
              Exportar a Word (.docx)
            </button>
            <button onclick="generarReporteAsistenciaPDF()" class="exp-asist-format-btn"
              style="flex:1;background:#FFEBEE;border-color:#FFCDD2;color:#C62828;">
              <span class="material-icons">picture_as_pdf</span>
              Exportar a PDF
            </button>
          </div>
        </div>

        <div id="exp-asist-preview" style="margin-top:12px;font-size:0.78rem;color:#78909C;"></div>
      </div>
    </div>
  </div>

  <!-- ===== MODAL DUPLICAR PLANIFICACIÓN ===== -->
  <div id="dup-plan-overlay" class="modal-overlay hidden" onclick="event.target===this&&cerrarDuplicarPlan()">
    <div class="modal-box" style="max-width:520px;" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3><span class="material-icons"
            style="vertical-align:middle;margin-right:6px;font-size:20px;">content_copy</span>Duplicar planificación
        </h3>
        <button class="modal-close" onclick="cerrarDuplicarPlan()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body" style="padding:20px 24px;">

        <!-- Info de la original -->
        <div id="dup-plan-origen"
          style="background:#F5F7FA;border-radius:8px;padding:10px 14px;border:1px solid #E0E0E0;margin-bottom:16px;font-size:0.82rem;color:#546E7A;">
        </div>

        <!-- Nombre de la copia -->
        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">label</span>Nombre de la copia</div>
          <input type="text" id="dup-plan-nombre"
            style="width:100%;padding:8px 12px;border:1.5px solid #E0E0E0;border-radius:8px;font-size:0.88rem;font-family:inherit;box-sizing:border-box;">
        </div>

        <!-- Curso destino -->
        <div class="config-section">
          <div class="config-section-title"><span class="material-icons">class</span>Asignar a un curso <span
              style="font-weight:400;color:#9E9E9E;">(opcional)</span></div>
          <select id="dup-plan-curso"
            style="width:100%;padding:8px 10px;border:1.5px solid #E0E0E0;border-radius:8px;font-size:0.88rem;font-family:inherit;">
            <option value="">Sin asignar (puedo hacerlo después)</option>
          </select>
        </div>

        <!-- Ajuste de fechas de actividades -->
        <div class="config-section" style="border:none;margin-bottom:0;">
          <div class="config-section-title"><span class="material-icons">date_range</span>Recorrer fechas de actividades
          </div>
          <p style="font-size:0.78rem;color:#78909C;margin:0 0 10px;">Si las actividades tienen fechas asignadas, puedes
            correrlas todas hacia adelante o atrás desde una fecha nueva de inicio.</p>
          <div class="toggle-row" style="padding:0 0 10px;">
            <div class="toggle-label">Ajustar fechas automáticamente<small>Desactiva para copiar las fechas
                exactas</small></div>
            <label class="toggle-switch">
              <input type="checkbox" id="dup-plan-ajustar-fechas" checked onchange="toggleDupFechas(this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div id="dup-plan-fechas-wrap">
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
              <label style="font-size:0.82rem;color:#546E7A;flex-shrink:0;">Nueva fecha de inicio:</label>
              <input type="date" id="dup-plan-fecha-inicio"
                style="flex:1;padding:7px 10px;border:1.5px solid #90CAF9;border-radius:8px;font-size:0.85rem;font-family:inherit;">
            </div>
            <div id="dup-plan-fechas-preview" style="margin-top:8px;font-size:0.75rem;color:#78909C;"></div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn-secundario" onclick="cerrarDuplicarPlan()">Cancelar</button>
        <button class="btn-siguiente" onclick="confirmarDuplicarPlan()">
          <span class="material-icons" style="font-size:16px;">content_copy</span> Duplicar
        </button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL BUSCADOR DE ESTUDIANTES ===== -->
  <div id="buscar-overlay" class="modal-overlay hidden" onclick="event.target===this&&cerrarBuscadorEstudiante()">
    <div class="modal-box" style="max-width:680px;max-height:90vh;display:flex;flex-direction:column;"
      onclick="event.stopPropagation()">
      <div class="modal-header" style="flex-shrink:0;">
        <h3><span class="material-icons"
            style="vertical-align:middle;margin-right:6px;font-size:20px;">search</span>Buscar estudiante</h3>
        <button class="modal-close" onclick="cerrarBuscadorEstudiante()"><span
            class="material-icons">close</span></button>
      </div>
      <!-- Barra de búsqueda sticky -->
      <div style="padding:14px 20px 10px;border-bottom:1px solid #E0E0E0;flex-shrink:0;" id="buscar-search-bar">
        <div style="position:relative;">
          <span class="material-icons"
            style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#90A4AE;font-size:20px;">search</span>
          <input type="text" id="buscar-input" placeholder="Escribe el nombre del estudiante…"
            oninput="buscarEstudiante(this.value)" autocomplete="off"
            style="width:100%;padding:10px 12px 10px 40px;border:1.5px solid #90CAF9;border-radius:10px;font-size:0.95rem;font-family:inherit;box-sizing:border-box;">
        </div>
        <div id="buscar-resultados-count" style="font-size:0.75rem;color:#9E9E9E;margin-top:6px;padding-left:4px;">
        </div>
      </div>
      <!-- Resultados + Perfil -->
      <div style="display:flex;flex:1;overflow:hidden;min-height:0;">
        <!-- Lista de resultados -->
        <div id="buscar-lista"
          style="width:260px;flex-shrink:0;overflow-y:auto;border-right:1px solid #E0E0E0;padding:8px 0;"></div>
        <!-- Perfil del estudiante seleccionado -->
        <div id="buscar-perfil" style="flex:1;overflow-y:auto;padding:16px 20px;"></div>
      </div>
    </div>
  </div>

  <!-- ===== MODAL DE INSTRUMENTO ===== -->
  <div id="modal-overlay" class="modal-overlay hidden" onclick="cerrarModal(event)">
    <div class="modal-box" id="modal-box">
      <div class="modal-header">
        <h3 id="modal-title">Instrumento de Evaluación</h3>
        <button class="modal-close" onclick="cerrarModalBtn()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Contenido del instrumento -->
      </div>
      <!-- Footer unificado: cambia contenido según contexto -->
      <div class="modal-footer" id="modal-footer">
        <button class="btn-export btn-print btn-sm" onclick="imprimirModal()">
          <span class="material-icons">print</span>
          Imprimir instrumento
        </button>
        <button class="btn-export btn-copy btn-sm" onclick="copiarModal()">
          <span class="material-icons">content_copy</span>
          Copiar
        </button>
        <button class="btn-secundario" onclick="cerrarModalBtn()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ===== TOAST ===== -->
  <div id="toast" class="toast hidden">
    <span class="material-icons" id="toast-icon">check_circle</span>
    <span id="toast-mensaje"></span>
  </div>


  <!-- ===== MODAL IMPORTAR PLANIFICACIÓN ===== -->
  <div id="imp-overlay" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:720px;max-height:90vh;display:flex;flex-direction:column;"
      onclick="event.stopPropagation()">
      <div class="modal-header" style="flex-shrink:0;">
        <h3 id="imp-titulo">Importar Planificación desde Word</h3>
        <button class="modal-close" onclick="imp_cerrar()"><span class="material-icons">close</span></button>
      </div>
      <div id="imp-steps-bar" style="display:flex;gap:0;border-bottom:1px solid #E0E0E0;flex-shrink:0;overflow-x:auto;">
      </div>
      <div id="imp-body" class="modal-body" style="flex:1;overflow-y:auto;padding:20px 24px;"></div>
      <div class="modal-footer"
        style="flex-shrink:0;display:flex;gap:8px;justify-content:flex-end;border-top:1px solid #E0E0E0;padding:12px 24px;">
        <button class="btn-secundario" id="imp-btn-prev" onclick="imp_anterior()" style="display:none;">
          <span class="material-icons">arrow_back</span> Anterior
        </button>
        <button class="btn-secundario" onclick="imp_cerrar()">Cancelar</button>
        <button class="btn-siguiente" id="imp-btn-next" onclick="imp_siguiente()">
          Siguiente <span class="material-icons">arrow_forward</span>
        </button>
      </div>
    </div>
  </div>


  <!-- ===== MODAL BACKUP / RESTAURAR DATOS ===== -->
  <div id="backup-overlay" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:560px;" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Mis Datos &mdash; Exportar / Importar</h3>
        <button class="modal-close" onclick="cerrarBackup()"><span class="material-icons">close</span></button>
      </div>
      <div class="modal-body" style="padding:20px 24px;">

        <!-- Exportar -->
        <div class="backup-section">
          <div class="backup-section-title">
            <span class="material-icons" style="color:#2E7D32;">cloud_download</span>
            Exportar mis datos
          </div>
          <p class="backup-desc">Descarga un archivo <strong>.json</strong> con todas tus planificaciones,
            calificaciones y sesiones diarias. Úsalo como respaldo o para cambiar de navegador/dispositivo.</p>
          <div id="backup-resumen" style="margin:10px 0;font-size:0.82rem;color:#616161;"></div>
          <button class="btn-siguiente" onclick="exportarDatos()" style="width:100%;justify-content:center;">
            <span class="material-icons">download</span> Descargar backup completo
          </button>
        </div>

        <div class="backup-divider"></div>

        <!-- Importar -->
        <div class="backup-section">
          <div class="backup-section-title">
            <span class="material-icons" style="color:#1565C0;">cloud_upload</span>
            Importar / Restaurar datos
          </div>
          <p class="backup-desc">Selecciona un archivo de backup generado anteriormente. <strong>Los datos actuales
              serán reemplazados</strong> por los del archivo.</p>
          <label class="backup-file-label" id="backup-file-label-btn">
            <span class="material-icons">attach_file</span>
            <span id="backup-file-name">Seleccionar archivo .json</span>
            <input type="file" id="backup-file-input" accept=".json" onchange="onBackupFileSelected(this)"
              style="display:none;">
          </label>
          <div id="backup-preview" class="hidden"
            style="margin:10px 0;background:#E3F2FD;border-radius:8px;padding:12px;font-size:0.82rem;"></div>
          <button class="btn-siguiente" id="backup-btn-importar" onclick="importarDatos()"
            style="width:100%;justify-content:center;display:none;background:linear-gradient(135deg,#1565C0,#1976D2);">
            <span class="material-icons">restore</span> Restaurar este backup
          </button>
        </div>

      </div>
      <div class="modal-footer" style="justify-content:flex-end;">
        <button class="btn-secundario" onclick="cerrarBackup()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Script principal -->
  <script src="docx.js"></script>
  <script src="app.js"></script>
</body>

</html>